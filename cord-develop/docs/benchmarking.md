# CORD Benchmarking:

Benchmarking enables to measure the time it takes to execute different functions in the runtime and under different conditions.

## How to add benchmarks for a new pallet:

```
1. Create `benchmarking.rs` file in pallet source.
2. Implement benchmarks for all extrinsic methods defined in the pallet.
   It is similar to writing a unit test case but with a asserting the event output which will
   be generated by the specific extrinsic method.
```

## Compile CORD with benchmark flag -

```
1. cd node/
2. Run->   `cargo build --release --features runtime-benchmarks`
```

## Run the benchmarks

After implementation of benchmarks, run the benchmarks along with unit test cases.

```
cargo test -p <pallet-name> --features=runtime-benchmarks
```

## Dependencies to be updated to generate weights to new pallet

To generate weights for the new pallet, changes must be made to `cargo.toml` file in the pallet and runtime to integrate the newly implemented `benchmark`.
This [documentation](https://docs.substrate.io/reference/how-to-guides/weights/add-benchmarks/) talks on how to integrate benchmark to generate weights for the pallet.

## Generating weights

Generation of a weight must be done on a machine with comparable specifications for accurate weight metrics, ex. on a remote gcp compute machine.

### Generate weights for all pallets

To generate weights for all pallets run the below script. It also has optional arguments for individual pallets.

```
./scripts/run_benches_for_pallets.sh
```

To generate weights for all pallets with runtime configuration run the below script.

```
./scripts/run_benches_for_runtime.sh
```

Running above scripts will generate a `weights.rs` file in respective pallets. For runtime it will generated in `runtime/src/weights`.

### Generating weight for individual pallet

Ex:
```
./target/release/cord benchmark --chain=dev --execution=wasm --pallet=pallet_mark --extrinsic='*' --steps=20 --repeat=10 --output=./pallets/mark/src/weights.rs --template=./.maintain/weight-template.hbs
```

## Integrating generated weight to pallet

Weights are used to manage the time it takes to validate a block.
We can integrate the weights to pallets as below,

Ex,
```
		#[pallet::weight(<T as pallet::Config>::WeightInfo::create())]
		pub fn create() {}
```

It is also possible to set default weight info to pallet-extrinsic methods
Ex,
```
        #[pallet::weight({0})]
 		pub fn create() {}
```

## File contents of `weights.rs`

File has been divided into 
```
1. Command to generate weights file.
2. Output from that command.
```
